# 牛子小助手 - 项目说明

## 项目概述
一个基于Docker的个人健康记录小程序，支持计时记录、数据统计和日历打卡等功能。

## 技术栈
- **前端**: React 18 + TypeScript + Vite + Ant Design 5 + ECharts
- **后端**: Node.js + Express + TypeScript + Sequelize
- **数据库**: PostgreSQL 15
- **认证**: JWT令牌
- **容器化**: Docker + Docker Compose

## 项目结构

```
niuzi-assistant/
├── frontend/                  # React前端应用
│   ├── src/
│   │   ├── components/        # 可复用组件
│   │   │   ├── TimerButton.tsx    # 计时按钮组件
│   │   │   ├── CalendarView.tsx   # 日历打卡视图
│   │   │   ├── StatsChart.tsx     # 统计图表组件
│   │   │   ├── StatsPanel.tsx     # 统计面板组件
│   │   │   └── PrivateRoute.tsx   # 私有路由组件
│   │   ├── pages/             # 页面组件
│   │   │   ├── LoginPage.tsx      # 登录注册页
│   │   │   └── HomePage.tsx       # 主页面
│   │   ├── contexts/          # React Context
│   │   │   └── AuthContext.tsx    # 认证上下文
│   │   ├── services/          # API服务
│   │   │   ├── api.ts            # Axios配置
│   │   │   ├── auth.ts           # 认证API
│   │   │   └── records.ts        # 记录API
│   │   ├── types/             # TypeScript类型
│   │   │   └── index.ts
│   │   ├── App.tsx            # 根组件
│   │   ├── main.tsx           # 入口文件
│   │   └── index.css          # 全局样式
│   ├── public/
│   ├── Dockerfile            # 前端Docker配置
│   ├── nginx.conf            # Nginx配置
│   ├── package.json
│   ├── tsconfig.json
│   └── vite.config.ts
├── backend/                   # Node.js后端应用
│   ├── src/
│   │   ├── models/           # 数据模型
│   │   │   ├── User.ts           # 用户模型
│   │   │   └── Record.ts         # 记录模型
│   │   ├── routes/           # API路由
│   │   │   ├── auth.ts           # 认证路由
│   │   │   └── records.ts        # 记录路由
│   │   ├── middleware/       # 中间件
│   │   │   └── auth.ts           # JWT认证中间件
│   │   ├── db/               # 数据库配置
│   │   │   └── index.ts
│   │   └── index.ts          # 入口文件
│   ├── Dockerfile            # 后端Docker配置
│   ├── package.json
│   └── tsconfig.json
├── database/                  # 数据库相关
│   └── init.sql              # 初始化脚本
├── docker-compose.yml        # Docker Compose配置
├── README.md                 # 项目文档
└── .gitignore               # Git忽略文件
```

## 功能特性

### 1. 用户认证
- 用户注册和登录
- JWT令牌认证
- 密码加密存储（bcrypt）

### 2. 计时记录
- 开始记录按钮
- 实时计时显示
- 结束记录并保存
- 记录历史查看

### 3. 数据统计
- 总记录数
- 总时长统计
- 平均时长
- 连续打卡天数
- 近30天频次统计

### 4. 可视化
- ECharts图表展示
- 日历打卡视图
- 日/周/月统计

### 5. 用户体验
- 响应式设计
- 美观的UI界面
- 流畅的交互动画
- 友好的错误提示

## 快速开始

### 前置要求
- Docker Desktop
- Docker Compose

### 启动项目

```bash
# 1. 进入项目目录
cd niuzi-assistant

# 2. 启动所有服务
docker-compose up -d

# 3. 查看日志
docker-compose logs -f
```

### 访问地址
- 前端应用: http://localhost:6688
- 后端API: http://localhost:3001/api
- API健康检查: http://localhost:3001/api/health

### 停止项目

```bash
# 停止服务
docker-compose down

# 停止并删除数据
docker-compose down -v
```

## 开发模式

### 前端开发
```bash
cd frontend
npm install
npm run dev
```
前端开发服务器: http://localhost:3000

### 后端开发
```bash
cd backend
npm install
npm run dev
```
后端开发服务器: http://localhost:3001

## API文档

### 认证API
| 方法 | 路径 | 说明 |
|------|------|------|
| POST | /api/auth/register | 用户注册 |
| POST | /api/auth/login | 用户登录 |
| GET | /api/auth/me | 获取当前用户信息 |
| POST | /api/auth/logout | 用户登出 |

### 记录API
| 方法 | 路径 | 说明 |
|------|------|------|
| POST | /api/records/start | 开始记录 |
| POST | /api/records/:id/end | 结束记录 |
| GET | /api/records | 获取记录列表 |
| GET | /api/records/stats | 获取统计信息 |
| DELETE | /api/records/:id | 删除记录 |

## 数据库设计

### users表
- id: 主键
- username: 用户名（唯一）
- password_hash: 密码哈希
- created_at: 创建时间
- updated_at: 更新时间

### records表
- id: 主键
- user_id: 用户ID（外键）
- start_time: 开始时间
- end_time: 结束时间
- duration: 持续时间（秒）
- created_at: 创建时间
- updated_at: 更新时间

## 环境变量

### 后端环境变量
```
NODE_ENV=production
PORT=3001
DATABASE_URL=postgresql://niuzi:niuzi123@database:5432/niuzi_db
JWT_SECRET=your-super-secret-jwt-key-change-in-production
JWT_EXPIRES_IN=7d
```

### 前端环境变量
```
VITE_API_URL=http://localhost:3001/api
```

## 常见问题

### 1. 数据库连接失败
确保Docker容器正常运行，检查PostgreSQL服务是否启动。

### 2. 前端无法连接后端
检查docker-compose.yml中的网络配置，确保服务间可以通信。

### 3. JWT令牌验证失败
检查.env文件中的JWT_SECRET是否一致。

## 开发计划

### 已完成功能
✅ 用户注册和登录
✅ 计时记录功能
✅ 数据统计
✅ 图表可视化
✅ 日历打卡视图
✅ Docker容器化部署

### 待开发功能
- 数据导出功能
- 成就系统
- 个性化设置
- 数据备份到云端
- PWA支持

## 贡献指南
欢迎提交Issue和Pull Request！

## 许可证
MIT License
